---
lab:
  title: 评估生成式 AI 模型的性能
  description: 了解如何评估模型和提示，以优化聊天应用的性能及响应的适当性。
---

# 评估生成式 AI 模型的性能

在本练习中，你将使用手动和自动化评估，以评估 Azure AI Foundry 门户中模型的性能。

该练习大约需要 **30** 分钟。

> **注意**：本练习中使用的一些技术处于预览版或积极开发阶段。 可能会遇到一些意想不到的行为、警告或错误。

## Azure AI Foundry 中心和项目

我们将在本练习中使用的 Azure AI Foundry 功能，需要基于 Azure AI Foundry *中心*资源的项目。

1. 在 Web 浏览器中打开 [Azure AI Foundry 门户](https://ai.azure.com)，网址为：`https://ai.azure.com`，然后使用 Azure 凭据登录。 关闭首次登录时打开的任何使用技巧或快速入门窗格，如有必要，使用左上角的 **Azure AI Foundry** 徽标导航到主页，类似下图所示（若已打开**帮助**面板，请关闭）：

    ![Azure AI Foundry 门户的屏幕截图。](./media/ai-foundry-home.png)

1. 在浏览器中，导航到 `https://ai.azure.com/managementCenter/allResources` 并选择“**创建**”。 然后选择创建新的 **AI 中心资源**的选项。
1. 在“**创建项目**”向导中，输入项目的有效名称，如果建议使用现有中心，请选择用于创建新中心的选项，然后展开“**高级选项**”，为项目指定以下设置：
    - **订阅**：Azure 订阅
    - **资源组**：*创建或选择资源组*
    - **中心名称**：中心的有效名称
    - **位置**：*选择以下任一位置*：\*
        - 美国东部 2
        - 法国中部
        - 英国南部
        - 瑞典中部

    > \* 撰写本文时，这些区域支持评估 AI 安全指标。 模型可用性受区域配额的约束。 如果稍后在练习中达到配额限制，可能需要在不同的区域中创建另一个资源。

1. 等待创建项目。

## 部署模型

在本练习中，你将评估 gpt-4o-mini 模型的性能。 你还将使用 gpt-4o 模型生成 AI 辅助的评估指标。

1. 在项目左侧窗格的**我的资产**部分中，选择**模型 + 终结点**页面。
1. 在“**模型 + 终结点**”页的“**模型部署**”选项卡中，在“**+ 部署模型**”菜单中，选择“**部署基础模型**”。
1. 在列表中搜索 **gpt-4o** 模型，然后选择并确认。
1. 在部署详细信息中选择“**自定义**”，并使用以下设置部署模型：
    - **部署名**：*有效的模型部署名*
    - **部署类型**：全局标准
    - **自动版本更新**：启用
    - **模型版本**：*选择最新可用版本*
    - **连接的 AI 资源**：*选择 Azure OpenAI 资源连接*
    - **每分钟令牌限制（千令牌）**：50K *（或如果订阅的可用上限低于 50K，则以其为准）*
    - **内容筛选器**：DefaultV2

    > **注意**：减少 TPM 有助于避免过度使用正在使用的订阅中可用的配额。 50,000 TPM 足以应对本练习所需的数据处理量。 如果可用配额低于上述 50,000 TPM，你仍然可完成本练习，但如果超过速率限制，可能会出现错误。

1. 等待部署完成。
1. 返回到**模型 + 终结点**页面，重复前述步骤，部署具有相同设置的 **gpt-4o-mini** 模型。

## 手动评估模型

可以根据测试数据手动审阅模型响应。 手动审阅可以让你每次测试不同的输入，以评估模型是否按预期执行。

1. 在新的浏览器标签页中，从 `https://raw.githubusercontent.com/MicrosoftLearning/mslearn-ai-studio/refs/heads/main/data/travel_evaluation_data.jsonl` 中下载  [travel_evaluation_data.jsonl](https://raw.githubusercontent.com/MicrosoftLearning/mslearn-ai-studio/refs/heads/main/data/travel_evaluation_data.jsonl) 并将其保存在本地文件夹中，文件名为 **travel_evaluation_data.jsonl**（请确认保存为 .jsonl 文件，而不是 .txt 文件）。
1. 返回到 Azure AI Foundry 门户选项卡，在导航窗格中的“**保护和治理**”部分，选择“**评估**”。
1. 如果“**创建新评估**”窗格自动打开，请选择“**取消**”将其关闭。
1. 在**评估**页面中，查看**手动评估**选项卡，然后选择 **+ 新建手动评估**。
1. 在“**配置**”部分的“**模型**”列表中，选择 **gpt-4o** 模型部署。
1. 将**系统消息**更改为以下 AI 旅行助理的说明：

   ```
   Assist users with travel-related inquiries, offering tips, advice, and recommendations as a knowledgeable travel agent.
   ```

1. 在“**手动评估结果**”部分中，选择“**导入测试数据**”，并上传之前下载的 **travel_evaluation_data.jsonl** 文件；向下滚动以映射数据集字段，如下所示：
    - **输入**：问题
    - **预期响应**：ExpectedResponse
1. 审阅测试文件中的问题和预期答案 - 你将使用这些问题和答案来评估模型生成的响应。
1. 从顶部栏中选择“运行”，以便为添加为输入的所有问题生成输出。**** 几分钟后，模型的响应应显示在新的 **输出**列中，如下所示：

    ![Azure AI Foundry 门户中的手动评估页面屏幕截图。](./media/manual-evaluation.png)

1. 审阅每个问题的输出，将模型生成的输出与预期答案对比，并在每个响应右下角选择拇指向上或向下图标来“评分”结果。
1. 对响应评分后，请审阅列表上方的摘要卡片。 然后在工具栏中，选择**保存结果**并分配合适的名称。 保存结果后，你可以稍后检索，以便进一步评估或与其他模型比较。

## 使用自动评估

虽然手动比较模型输出与自己的预期响应可能是评估模型性能的有效方法，但在预期存在各种问题和响应的情况下，这种方法较为耗时；而且它提供的标准化指标的方式较少，难以用于比较不同的模型和提示组合。

自动评估是一种尝试计算指标并使用 AI 评估相应的一致性、相关性及其他因素，以解决这些不足的方法。

1. 使用**手动评估**页标题旁边的后退箭头（&larr;****），返回到**评估**页面。
1. 查看**自动评估**选项卡。
1. 选择“**创建新评估**”，在提示出现时，选择“**评估模型**”选项，然后选择“**下一步**”。
1. 在“**选择数据源**”页上，选择“**使用数据集**”，并根据之前上传的文件选择 **travel_evaluation_data_jsonl_*xxxx...*** 数据集，然后选择“**下一步**”。
1. 在“**测试模型**”页上，选择 **gpt-4o-mini** 模型，并将“**系统消息**”更改为与之前使用的 AI 旅行助手相同的说明：

   ```
   Assist users with travel-related inquiries, offering tips, advice, and recommendations as a knowledgeable travel agent.
   ```

1. 对于“**查询**”字段，请选择 **\{\{item.question\}\}**。
1. 选择“下一步”转到下一页****。
1. 在“**配置评估程序**”页上，使用“**+添加**”按钮添加以下评估程序，并按如下所示配置每个计算器：
    - **模型评分器**：
        - **条件名称**：Semantic_similarity
        - **评分依据**：*选择 **gpt-4o** 模型*
        - **用户**设置（位于底部）：


            输出：\{\{sample.output_text\}\}<br>
            基本事实：\{\{item.ExpectedResponse\}\}<br>
            <br>
        
    - **Likert 量表评估程序**：
        - **条件名称**：相关性
        - **评分依据**：*选择 **gpt-4o** 模型*
        - **查询**：\{\{item.question\}\}

    - **文本相似性**：
        - **条件名称**：F1_Score
        - **基本事实**：\{\{item.ExpectedResponse\}\}

    - **仇恨和不公平内容**：
        - **条件名称**：Hate_and_unfairness
        - **查询**：\{\{item.question\}\}

1. 选择“**下一步**”查看评估设置。 你应该已将评估配置为使用旅行评估数据集来评估 **gpt-4o-mini** 模型的语义相似性、相关性、F1 分数以及仇恨和不公平的语言。
1. 为评估指定一个合适的名称，然后“**提交**”以启动评估流程，并等待评估完成。 可能需要几分钟时间。 可以使用工具栏按钮“**刷新**”来检查状态。

1. 评估完成后，如有必要，请向下滚动以查看结果。

    ![评估指标的屏幕截图。](./media/ai-quality-metrics.png)

1. 在页面顶部，选择“**数据**”选项卡，以查看评估的原始数据。 数据包括每个输入的指标，以及 gpt-4o 模型在评估响应时所应用的推理说明。

## 清理

完成对 Azure AI Foundry 的探索后，应删除已创建的资源，以避免产生不必要的 Azure 成本。

- 导航到 Azure 门户，地址为 `https://portal.azure.com`[](https://portal.azure.com)。
- 在 Azure 门户的**主页**上，选择“资源组”。
- 选择你为本练习创建的资源组。
- 在资源组的“概述”页的顶部，选择“删除资源组”。
- 输入资源组名称以确认要删除该资源组，然后选择“删除”。
